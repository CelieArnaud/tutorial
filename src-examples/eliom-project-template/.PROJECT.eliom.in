{shared{
  open Eliom_pervasives
}}

{client{
  let hello () =
    Dom_html.window##alert(Js.string "Pheew, even with interaction!")
}}

module %%MODULE_NAME%%_appl =
  Eliom_output.Eliom_appl (struct
    let application_name = "%%PROJECT_NAME%%"
  end)

let main_service =
  Eliom_services.service ~path:[] ~get_params:Eliom_parameters.unit ()

let counter = Eliom_references.eref ~scope:Eliom_common.session 0

let main_handler () () =
  lwt count =
    lwt () = Eliom_references.modify counter succ in
    Eliom_references.get counter
  in
  let message = Printf.sprintf "Welcome to Eliom! (for the %d. time)" count in
  Lwt.return
    (Eliom_tools.Html5.html_page
       ~title:"%%PROJECT_NAME%%"
       ~css:[["%%PROJECT_NAME%%.css"]]
       HTML5.(Eliom_output.Html5.([
         h1 [pcdata "Gratulations!"];
         div [
           pcdata message;
           a ~service:main_service [pcdata " ... and again ..."] ();
         ];
         div [span ~a:[a_onmouseover {{ hello () }}] [pcdata "hover me!"]];
       ])))

let () =
  %%MODULE_NAME%%_appl.register ~service:main_service main_handler
